<div class="row g-0 h-100">
    <div id="sidebar" class="col-auto p-3">
        <div class="row g-0 flex-column h-100">
            <div *ngIf="gameState() === GameState.deploying; else gameEvents" class="col">
                <div class="d-flex flex-column">
                    <div *ngFor="let ship of deployableShips()"
                        class="deployable-ship"
                        draggable="true"
                        [attr.data-ship-id]="ship.id"
                        [attr.data-ship-length]="ship.length"
                        [attr.data-ship-orientation]="ship.orientation"
                        (dragstart)="shipDragStart($event)"
                        (dragend)="shipDragEnd($event)"
                    >
                        <span>{{ ship.name }}</span>
                    </div>
                </div>
            </div>
            <ng-template #gameEvents>
                <div class="col">
                    Game events
                </div>
            </ng-template>
            <div class="col-auto d-flex flex-column">
                <button *ngIf="gameState() === GameState.deploying"
                    class="confirm-button mb-3"
                    [disabled]="deployableShips().length > 0"
                    (click)="deploy()"
                >
                    <span>Deploy</span>
                </button>
                <button class="mb-3" (click)="showSettingsDialog()">Settings</button>
                <button class="cancel-button" (click)="quit()">Quit</button>
            </div>
        </div>
    </div>

    <div id="grid-container" class="col p-5">
        <div id="grid"
            [ngClass]="{
                'player-turn': gameManager.gameInstance.turn() === Turn.player,
                'computer-turn': gameManager.gameInstance.turn() === Turn.computer
            }"
            (dragleave)="gridDragLeave($event)"
        >
            <div id="grid-col-labels">
                <span *ngFor="let col of [].constructor(10); let i = index" class="grid-col-label">{{ i + 1 }}</span>
            </div>

            <div id="grid-row-labels">
                <span *ngFor="let col of [].constructor(10); let i = index" class="grid-row-label">{{ String.fromCharCode(65 + i) }}</span>
            </div>

            <ng-container *ngFor="let row of gridSectors(); let r = index">
                <ng-container *ngFor="let sector of row; let c = index">
                    <div *ngIf="gameManager.gameInstance.turn() === Turn.player || !sector.state.hasFlag(SectorState.ship)"
                        class="sector"
                        [ngClass]="{
                            'targeted': sector.state.hasFlag(SectorState.miss) || sector.state.hasFlag(SectorState.hit)
                        }"
                        [attr.data-row]="r"
                        [attr.data-col]="c"
                        (dragover)="sectorDragOver($event)"
                        (drop)="sectorDrop($event)"
                        (click)="sectorClick(r, c)"
                    ></div>
                </ng-container>
            </ng-container>

            <div *ngIf="showPlaceholder()" id="deployable-ship-placeholder"></div>

            <div *ngFor="let ship of deployedShips()"
                class="deployed-ship"
                draggable="true"
                [attr.data-ship-id]="ship.id"
                [attr.data-ship-length]="ship.length"
                [attr.data-ship-orientation]="ship.orientation"
                [style.gridRowStart]="ship.anchorSector.r + 1"
                [style.gridRowEnd]="ship.orientation === ShipOrientation.horizontal ? 'span 1' : ('span ' + ship.length)"
                [style.gridColumnStart]="ship.anchorSector.c + 1"
                [style.gridColumnEnd]="ship.orientation === ShipOrientation.horizontal ? ('span ' + ship.length) : 'span 1'"
                (dragstart)="shipDragStart($event)"
                (dragend)="shipDragEnd($event)"
                (click)="rotateShip(ship.id)"
            >
                <div class="ship-model h-100 w-100 d-flex align-items-center justify-content-center position-relative">
                    <span class="position-absolute">{{ ship.name }}</span>
                    <!-- TODO - ship art -->
                    <!-- <img priority
                        fill="true"
                        [alt]="ship.name"
                        [ngSrc]="'/assets/images/warships/' + ship.id + '.png'"
                        [ngClass]="ship.orientation === ShipOrientation.vertical ? 'vertical' : ''"
                    > -->
                </div>
            </div>
        </div>

        <div id="grid-overlays-container" class="p-5">
            <div id="grid-overlays">
                <ng-container *ngFor="let row of gridSectors(); let r = index">
                    <ng-container *ngFor="let sector of row; let c = index">
                        <div class="sector-overlay d-flex align-items-center justify-content-center">
                            <i *ngIf="sector.state.hasFlag(SectorState.miss) || sector.state.hasFlag(SectorState.hit)"
                                class="fas fa-2x fa-map-marker"
                                [ngClass]="{
                                    'miss': sector.state.hasFlag(SectorState.miss),
                                    'hit': sector.state.hasFlag(SectorState.hit)
                                }"
                            ></i>
                        </div>
                    </ng-container>
                </ng-container>
            </div>
        </div>
    </div>
</div>
